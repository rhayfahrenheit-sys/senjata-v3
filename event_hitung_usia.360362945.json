{
	"type": "EVENT_FIELD",
	"name": "hitung_usia",
	"serverCode": "\n// Sample:\n$result[\"upper\"] = strtoupper( $params[\"value\"] );\n",
	"beforeJsCode": "$(document).ready(function() {\r\n    \r\n    function calculateAge() {\r\n        var tglLahirCtrl = Runner.getControl(pageid, 'tgl_lahir');\r\n        var tglCtrl = Runner.getControl(pageid, 'tgl');\r\n        \r\n        if (!tglLahirCtrl || !tglCtrl) return;\r\n        \r\n        var tglLahir = tglLahirCtrl.getValue();\r\n        var tgl = tglCtrl.getValue();\r\n        \r\n        if (!tglLahir || !tgl) return;\r\n        \r\n        // Handle object Date or string\r\n        var birth = (tglLahir instanceof Date) ? tglLahir : parseDate(tglLahir);\r\n        var ref = (tgl instanceof Date) ? tgl : parseDate(tgl);\r\n        \r\n        if (!birth || !ref || birth > ref) {\r\n            if (birth > ref) {\r\n                alert('Error: Tanggal lahir tidak boleh lebih besar dari tanggal periksa!');\r\n            }\r\n            Runner.getControl(pageid, 'umur_t').setValue('');\r\n            Runner.getControl(pageid, 'umur_b').setValue('');\r\n            Runner.getControl(pageid, 'umur_h').setValue('');\r\n            Runner.getControl(pageid, 'usia').setValue('');\r\n            return;\r\n        }\r\n        \r\n        // Calculate age\r\n        var years = ref.getFullYear() - birth.getFullYear();\r\n        var months = ref.getMonth() - birth.getMonth();\r\n        var days = ref.getDate() - birth.getDate();\r\n        \r\n        // Adjust negative days\r\n        if (days < 0) {\r\n            var lastMonth = new Date(ref.getFullYear(), ref.getMonth(), 0);\r\n            days += lastMonth.getDate();\r\n            months--;\r\n        }\r\n        \r\n        // Adjust negative months\r\n        if (months < 0) {\r\n            months += 12;\r\n            years--;\r\n        }\r\n        \r\n        // Set values\r\n        Runner.getControl(pageid, 'umur_t').setValue(years);\r\n        Runner.getControl(pageid, 'umur_b').setValue(months);\r\n        Runner.getControl(pageid, 'umur_h').setValue(days);\r\n        \r\n        var usia = '';\r\n        if (years > 0) usia += years + ' tahun ';\r\n        if (months > 0) usia += months + ' bulan ';\r\n        if (days > 0) usia += days + ' hari';\r\n        \r\n        Runner.getControl(pageid, 'usia').setValue(usia.trim());\r\n    }\r\n    \r\n    function parseDate(dateStr) {\r\n        if (!dateStr || typeof dateStr !== 'string') return null;\r\n        \r\n        var parts = dateStr.split('/');\r\n        if (parts.length === 3) {\r\n            var day = parseInt(parts[0]);\r\n            var month = parseInt(parts[1]) - 1;\r\n            var year = parseInt(parts[2]);\r\n            \r\n            var date = new Date(year, month, day);\r\n            \r\n            if (date.getFullYear() === year && \r\n                date.getMonth() === month && \r\n                date.getDate() === day) {\r\n                return date;\r\n            }\r\n        }\r\n        \r\n        var isoDate = new Date(dateStr);\r\n        if (!isNaN(isoDate.getTime())) {\r\n            return isoDate;\r\n        }\r\n        \r\n        return null;\r\n    }\r\n    \r\n    // Bind events\r\n    Runner.getControl(pageid, 'tgl_lahir').on('change', calculateAge);\r\n    Runner.getControl(pageid, 'tgl').on('change', calculateAge);\r\n    \r\n    // Initial trigger\r\n    setTimeout(calculateAge, 500);\r\n});\r\n\r\nreturn false;",
	"afterJsCode": "\n\n// Sample:\nctrl.setValue( result[\"upper\"] );\n"
}