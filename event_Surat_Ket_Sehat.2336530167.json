{
	"type": "EVENT_BUTTON",
	"name": "Surat Ket Sehat",
	"serverCode": "$loketid = $params[\"loketid\"] ?? \"\";\r\n$_SESSION[\"loket_id\"]=$params[\"loketid\"];\r\n\r\n// Simpan loketid ke response (untuk dikirim ke client)\r\n$result[\"loketid\"] = $loketid;\r\n\r\n// Cek keberadaan data di tabel surat_sehat\r\n// ⚠️ PENTING: \r\n// 1. Tidak pakai quote di ':1' \r\n// 2. Tidak overwrite variabel $result\r\n// 3. Handle return type DB::Lookup dengan aman\r\n$sql = DB::PrepareSql(\r\n    \"SELECT COUNT(loket_id) AS jumlah FROM surat_sehat WHERE loket_id = ':1'\",\r\n    $loketid\r\n);\r\n\r\n$dbResult = DB::Lookup($sql);\r\n\r\n// Ekstrak nilai count dengan aman\r\n$jumlah = 0;\r\nif (is_array($dbResult) && isset($dbResult['jumlah'])) {\r\n    $jumlah = (int)$dbResult['jumlah'];\r\n} elseif (is_numeric($dbResult)) {\r\n    $jumlah = (int)$dbResult; // Handle jika return langsung angka\r\n}\r\n\r\n// Set flag berdasarkan hasil\r\n$result[\"tanda\"] = ($jumlah > 0) ? \"1\" : \"0\";",
	"beforeJsCode": "\nparams[\"loketid\"] = row.getFieldValue(\"loket_id\");\n\n\n",
	"afterJsCode": "if (result[\"tanda\"] === \"1\") {\r\n    // Data ADA → buka halaman EDIT dengan parameter loket_id\r\n    Runner.displayPopup({\r\n        url: \"surat_sehat_edit.php?editid1=\" + encodeURIComponent(result[\"loketid\"]),\r\n        width: \"75%\",\r\n        height: \"75%\",\r\n        header: \"Edit Surat Keterangan Sehat\"\r\n    });\r\n} else {\r\n    // Data BELUM ADA → buka halaman ADD dengan parameter loket_id\r\n    Runner.displayPopup({\r\n        url: \"surat_sehat_add.php\",\r\n        width: \"75%\",\r\n        height: \"75%\",\r\n        header: \"Buat Surat Keterangan Sehat Baru\"\r\n    });\r\n}"
}